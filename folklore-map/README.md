## 民俗学マップ（仮） — Next.js 開発ベース

Sechack365 で発表予定の「民俗学版 大島てる」アプリケーションを実装するための Next.js 初期プロジェクトです。リポジトリ直下にある要件定義・設計ドキュメント（`requirements.md` / `basic_design.md` / `detailed_design.md` など）と併せて活用し、段階的に機能を拡張していきます。

### 現状の構成
- Next.js 16（App Router, TypeScript, `src/` ディレクトリ構成）
- React 19.2.0
- Tailwind CSS v4（`@tailwindcss/postcss` 連携済み）
- Prisma 6.18.0 + PostgreSQL（Supabase経由）
- Supabase SSR 0.7.0（認証・データベース）
- Google Maps JavaScript API統合済み
- shadcn UI CLI 初期化済み

### 実装済み機能

**コア機能**:
- ✅ Google Mapsを使用したインタラクティブな地図表示
- ✅ スポット一覧・詳細表示API（`/api/spots`, `/api/spots/[id]`）
- ✅ 地理的プライバシー機能（座標ぼかし: 100-300m）
- ✅ 104件の日本民俗学伝承データ（全国各地を網羅、出典URL/書籍付き）
- ✅ Next.js 16互換性対応（async params, Supabase SSR cookie handling）

**UI/UX機能**:
- ✅ 和風デザイン（日本の伝統色: 和紙色、墨色、朱色、藍色）
- ✅ 日本語Webフォント（Noto Serif JP明朝体、Zen Kaku Gothicゴシック体）
- ✅ icon_typeに応じた絵文字マーカー（👹鬼、🦊狐、🐉龍、⛩️神社など）
- ✅ 選択時のアニメーション効果（拡大、発光シャドウ）

**ソーシャル機能**:
- ✅ いいね機能（ハートアイコン、トグル対応、いいね数表示）
- ✅ セッションベースのユーザー識別（ログイン不要）
- ✅ いいね状態の永続化（データベース + ローカルストレージ）

**管理機能**:
- ✅ 管理者分析ダッシュボード（スポット追加履歴、検索ログ、人気指標）
- ✅ CSVエクスポート機能（期間フィルタ対応）
- ✅ ロールベースアクセス制御（reviewer以上のみアクセス可能）
- ⚠️ 開発中: 認証チェック一時無効化（本番環境では要有効化）

**古地図比較機能**:
- ✅ 今昔マップ on the webとの統合（明治期古地図表示）
- ✅ 現代地図⇔古地図のレイヤー切り替え
- ✅ TMS形式タイルの正しい座標変換
- ✅ クレジット表記の自動切り替え
- ✅ 全国16地域対応（札幌、仙台、東京、名古屋、大阪、広島、福岡など）
- ✅ 表示位置に応じた地域データセットの自動選択

> Next.js 16 + React 19環境での互換性問題は解決済みです。詳細は `docs/development-log.md` を参照してください。

## 開発サーバーの起動

```bash
pnpm install
pnpm dev
```

ブラウザで <http://localhost:3000> を開くと、地図ビューのプレースホルダーと開発方針の概要を確認できます。`src/app/page.tsx` を編集すると即座に反映されます。

## 初期データの投入

データベースに104件の全国網羅サンプルデータを投入するには:

```bash
pnpm tsx scripts/seed-data-100.ts
```

これにより、酒呑童子、九尾の狐、ヤマタノオロチなどの有名な伝承から、北海道のアイヌコタン、東北の恐山、関東の平将門、中部の善光寺、関西の清水寺、中国の厳島神社、四国の四国八十八ヶ所、九州の太宰府、沖縄の首里城まで、日本全国各地の民俗学伝承がマップ上に表示されます。

従来の10件データを投入する場合:

```bash
pnpm seed
```

## 推奨される次のステップ
1. ✅ ~~Google Maps JS API を組み込んだ `Map` コンポーネントの実装~~ （完了）
2. ✅ ~~Prisma/Supabase 連携による `/api/spots` エンドポイントの構築~~ （完了）
3. ✅ ~~和風UI/UXデザインの適用~~ （完了）
4. ✅ ~~icon_typeに応じたカスタムマーカーアイコンの実装~~ （完了）
5. ✅ ~~今昔マップ on the webとの統合（古地図比較機能）~~ （完了）
6. 投稿フォームの完成とバリデーション強化
7. レビュー画面の実装（reviewer/admin権限対応）
8. 通報機能（Flag）の実装
9. Google Geocoding API統合（住所→座標変換）
10. 画像アップロード機能（Supabase Storage）
11. ユーザー認証フローの改善
12. 複数時代の古地図切り替え（大正期、昭和初期など）
13. 透明度スライダーによる古地図の透過度調整
14. E2Eテストの追加
15. `pnpm lint` / `pnpm test` を用意し GitHub Actions CI と連動

## ドキュメント

- **開発ガイド**: `docs/setup-guide.md` - 環境構築とトラブルシューティング
- **開発ログ**: `docs/development-log.md` - 実施した作業と技術的な問題解決の記録
- **要件定義**: `requirements.md` - プロジェクトの目的と要件
- **基本設計**: `basic_design.md` - アーキテクチャと技術選定
- **詳細設計**: `detailed_design.md` - 機能仕様とAPI設計
- **DB設計**: `db_design.md` - データモデルとRLSポリシー
- **API設計**: `api_design.md` - APIエンドポイント仕様
- **分析機能**: `analytics.md` - 管理者分析ダッシュボードの詳細
- **タスク管理**: `tasks.md` - 実装タスクの進捗管理
