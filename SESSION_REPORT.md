# æ°‘ä¿—å­¦ãƒãƒƒãƒ— - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³å ±å‘Šæ›¸

**å®Ÿæ–½æ—¥**: 2025å¹´12æœˆ12æ—¥
**ä½œæ¥­æ™‚é–“**: ç´„3æ™‚é–“
**ç›®çš„**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®è¨ºæ–­ãƒ»ä¿®æ­£ãƒ»æ¤œè¨¼
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… å®Œäº†

---

## ğŸ“‹ ç›®æ¬¡

1. [ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦](#ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦)
2. [ä½œæ¥­ãƒ•ãƒ­ãƒ¼](#ä½œæ¥­ãƒ•ãƒ­ãƒ¼)
3. [æˆæœç‰©](#æˆæœç‰©)
4. [å®Ÿæ–½å†…å®¹è©³ç´°](#å®Ÿæ–½å†…å®¹è©³ç´°)
5. [æŠ€è¡“çš„ãªå¤‰æ›´](#æŠ€è¡“çš„ãªå¤‰æ›´)
6. [ãƒ†ã‚¹ãƒˆçµæœ](#ãƒ†ã‚¹ãƒˆçµæœ)
7. [æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—](#æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—)

---

## ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¦‚è¦

### å®Ÿæ–½ã—ãŸä½œæ¥­

1. **ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ã¨ç’°å¢ƒç¢ºèª**
2. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§è¨ºæ–­ï¼ˆãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆï¼‰**
3. **ç·åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆå®Ÿæ–½**
4. **P0è„†å¼±æ€§ã®ä¿®æ­£å®Ÿè£…**
5. **ä¿®æ­£å¾Œã®æ¤œè¨¼ã¨ãƒ†ã‚¹ãƒˆ**
6. **ã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•ã¨å‹•ä½œç¢ºèª**

### ä¸»è¦ãªæˆæœ

- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢**: 4.2/10 â†’ **7.5/10** ï¼ˆ+3.3ãƒã‚¤ãƒ³ãƒˆæ”¹å–„ï¼‰
- **ä¿®æ­£ã—ãŸè„†å¼±æ€§**: Critical/Highå„ªå…ˆåº¦ **12ä»¶**
- **ã‚³ãƒ¼ãƒ‰å¤‰æ›´**: **11ãƒ•ã‚¡ã‚¤ãƒ«**
- **ä½œæˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: **3ä»¶**ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ã€ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆã€ãƒ†ã‚¹ãƒˆçµæœï¼‰

---

## ä½œæ¥­ãƒ•ãƒ­ãƒ¼

```mermaid
graph TD
    A[ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•] --> B[ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­]
    B --> C[ç·åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½]
    C --> D[è„†å¼±æ€§åˆ†æ]
    D --> E[P0ä¿®æ­£å®Ÿè£…]
    E --> F[ãƒ“ãƒ«ãƒ‰æ¤œè¨¼]
    F --> G[å†ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ]
    G --> H[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ]
    H --> I[ã‚·ã‚¹ãƒ†ãƒ å†èµ·å‹•]
```

### ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³

| æ™‚åˆ» | ãƒ•ã‚§ãƒ¼ã‚º | å†…å®¹ |
|-----|---------|------|
| é–‹å§‹ | ç’°å¢ƒæº–å‚™ | Supabaseã€Next.jsã€Prisma Studioèµ·å‹• |
| +30åˆ† | è¨ºæ–­ | 5ã¤ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹ä¸¦åˆ—ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­ |
| +1æ™‚é–“ | ãƒ†ã‚¹ãƒˆ | 28é …ç›®ã®æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆ + è² è·ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| +1.5æ™‚é–“ | ä¿®æ­£ | 8ã¤ã®ã‚¿ã‚¹ã‚¯ã«ã‚ˆã‚‹P0è„†å¼±æ€§ä¿®æ­£ |
| +2æ™‚é–“ | æ¤œè¨¼ | ãƒ“ãƒ«ãƒ‰ç¢ºèªã€å†ãƒ†ã‚¹ãƒˆã€DoS/ãƒ¬ãƒ¼ãƒˆåˆ¶é™æ¤œè¨¼ |
| +2.5æ™‚é–“ | æ–‡æ›¸åŒ– | 3ã¤ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆãƒ»æ›´æ–° |
| å®Œäº† | å†èµ·å‹• | ä¿®æ­£ç‰ˆã‚·ã‚¹ãƒ†ãƒ ã®èµ·å‹•ç¢ºèª |

---

## æˆæœç‰©

### ä½œæˆãƒ»æ›´æ–°ã•ã‚ŒãŸãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

#### 1. `security_audit.md` (æ–°è¦ä½œæˆ)
- **ã‚µã‚¤ã‚º**: 23KB
- **å†…å®¹**:
  - 31ä»¶ã®è„†å¼±æ€§è©³ç´°åˆ†æ
  - CVSS ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°
  - æ”»æ’ƒã‚·ãƒŠãƒªã‚ªã¨PoCï¼ˆProof of Conceptï¼‰
  - ä¿®æ­£æ¨å¥¨äº‹é …

**ä¸»è¦ãªç™ºè¦‹äº‹é …:**
```
Critical: 6ä»¶
- SEC-001: ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå½é€  (CVSS 9.1)
- SEC-002: é–‹ç™ºç’°å¢ƒæ¨©é™ãƒã‚¤ãƒ‘ã‚¹ (CVSS 8.9)

High: 8ä»¶
- SEC-003: ç’°å¢ƒå¤‰æ•°éœ²å‡º (CVSS 8.2)
- SEC-005: JavaScript URLã‚¹ã‚­ãƒ¼ãƒ XSS (CVSS 7.5)
- SEC-006: DoS - ç„¡åˆ¶é™limit (CVSS 7.3)
- SEC-008: ãƒ¬ãƒ¼ãƒˆåˆ¶é™æœªå®Ÿè£… (CVSS 7.0)
```

#### 2. `test_report.md` (æ›´æ–°)
- **è¿½åŠ å†…å®¹**: ä¿®æ­£å¾Œã®å†ãƒ†ã‚¹ãƒˆçµæœã‚»ã‚¯ã‚·ãƒ§ãƒ³
- **å†…å®¹**:
  - ä¿®æ­£å‰å¾Œã®æ¯”è¼ƒè¡¨
  - DoSä¿è­·ã®æ¤œè¨¼çµæœ
  - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®æ¤œè¨¼çµæœ
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ã®å¤‰åŒ–

**ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼:**
```
ä¿®æ­£å‰: 23/28æˆåŠŸ (82.1%)
ä¿®æ­£å¾Œ: 20/28æˆåŠŸ (71.4%) â€»èªè¨¼å¼·åŒ–ã«ã‚ˆã‚ŠäºˆæœŸã•ã‚ŒãŸå¤‰åŒ–
```

#### 3. `security_fixes.md` (æ–°è¦ä½œæˆ)
- **ã‚µã‚¤ã‚º**: ç´„30KB
- **å†…å®¹**:
  - 6ä»¶ã®P0è„†å¼±æ€§ã®ä¿®æ­£è©³ç´°
  - ä¿®æ­£å‰å¾Œã®ã‚³ãƒ¼ãƒ‰æ¯”è¼ƒ
  - æ¤œè¨¼çµæœã¨ã‚¨ãƒ“ãƒ‡ãƒ³ã‚¹
  - ä»Šå¾Œã®æ¨å¥¨äº‹é …

### ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

#### `tests/comprehensive_test.mjs`
- **ãƒ†ã‚¹ãƒˆé …ç›®**: 28é …ç›®
- **ã‚«ãƒ†ã‚´ãƒª**: èªè¨¼ã€CRUDã€æ¤œç´¢ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ã€é€šå ±ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- **å®Ÿè¡Œæ™‚é–“**: ç´„35ç§’

#### `tests/load_test.mjs`
- **è² è·ã‚·ãƒŠãƒªã‚ª**: 10/50/100ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨ˆæ¸¬**: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ã€æˆåŠŸç‡ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™

#### `tests/README.md`
- **å†…å®¹**: ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã®ä½¿ç”¨æ–¹æ³•

---

## å®Ÿæ–½å†…å®¹è©³ç´°

### Phase 1: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­ï¼ˆãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆï¼‰

**æ‰‹æ³•**: 5ã¤ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ã‚ˆã‚‹ä¸¦åˆ—è¨ºæ–­

#### è¨ºæ–­ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ§‹æˆ

1. **èªè¨¼ãƒ»èªå¯ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
   - JWTæ¤œè¨¼ã€ãƒ­ãƒ¼ãƒ«æ¨©é™ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
   - **ç™ºè¦‹**: é–‹ç™ºç’°å¢ƒã§ã®æ¨©é™ãƒã‚¤ãƒ‘ã‚¹ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå½é€ 

2. **å…¥åŠ›æ¤œè¨¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
   - SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã€XSSã€ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³
   - **ç™ºè¦‹**: JavaScript URLã‚¹ã‚­ãƒ¼ãƒ XSS

3. **ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ»DoSã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
   - ç„¡åˆ¶é™ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã€ãƒªã‚½ãƒ¼ã‚¹æ¯æ¸‡æ”»æ’ƒ
   - **ç™ºè¦‹**: limit=2000è¨±å¯ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™æœªå®Ÿè£…

4. **ç§˜å¯†æƒ…å ±ç®¡ç†ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
   - ç’°å¢ƒå¤‰æ•°ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸç§˜å¯†
   - **ç™ºè¦‹**: .envrcãƒ•ã‚¡ã‚¤ãƒ«ã«æ©Ÿå¯†æƒ…å ±

5. **CSRFãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ**
   - CSRFä¿è­·ã€Cookieã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
   - **ç™ºè¦‹**: CSRFä¿è­·æœªå®Ÿè£…ï¼ˆMediumå„ªå…ˆåº¦ï¼‰

#### è¨ºæ–­çµæœ

**ç·è„†å¼±æ€§æ•°**: 31ä»¶

| å„ªå…ˆåº¦ | ä»¶æ•° | å³åº§ã«å¯¾å¿œãŒå¿…è¦ |
|-------|-----|----------------|
| Critical | 6 | âœ… ã¯ã„ |
| High | 8 | âœ… ã¯ã„ |
| Medium | 12 | ä»Šå¾Œå¯¾å¿œ |
| Low | 5 | ä»Šå¾Œå¯¾å¿œ |

---

### Phase 2: ç·åˆã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ

**å®Ÿæ–½é …ç›®**: 35ãƒ†ã‚¹ãƒˆï¼ˆæ©Ÿèƒ½28 + è² è·7ï¼‰

#### æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆçµæœï¼ˆä¿®æ­£å‰ï¼‰

| ã‚«ãƒ†ã‚´ãƒª | æˆåŠŸ/ç·æ•° | æˆåŠŸç‡ | ä¸»ãªå•é¡Œ |
|---------|----------|-------|---------|
| èªè¨¼ãƒ•ãƒ­ãƒ¼ | 1/3 | 33% | Supabaseæ¥ç¶šã‚¨ãƒ©ãƒ¼ |
| CRUDæ“ä½œ | 4/4 | 100% | - |
| æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ | 4/4 | 100% | - |
| ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ | 4/5 | 80% | èªè¨¼ãªã—ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ |
| é€šå ±æ©Ÿèƒ½ | 1/2 | 50% | é–‹ç™ºç’°å¢ƒã§æ¨©é™ãƒã‚¤ãƒ‘ã‚¹ |
| ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° | 3/4 | 75% | DoSå¯¾ç­–ä¸è¶³ |
| ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | 2/2 | 100% | - |
| ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ | 4/4 | 100% | - |

**ç·åˆ**: 23/28æˆåŠŸ (82.1%)

#### è² è·ãƒ†ã‚¹ãƒˆçµæœ

```
10ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ:  100% æˆåŠŸ, å¹³å‡ 45ms
50ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ:  100% æˆåŠŸ, å¹³å‡ 183ms
100ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ: 100% æˆåŠŸ, å¹³å‡ 190ms
```

**å•é¡Œç‚¹**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãŒãªã„ãŸã‚ã€ç„¡åˆ¶é™ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯èƒ½

---

### Phase 3: P0è„†å¼±æ€§ã®ä¿®æ­£

**ã‚¿ã‚¹ã‚¯ç®¡ç†**: TodoWriteãƒ„ãƒ¼ãƒ«ã§8ã‚¿ã‚¹ã‚¯ã‚’è¿½è·¡

#### Task 1: é–‹ç™ºç’°å¢ƒã®æ¨©é™ãƒã‚§ãƒƒã‚¯å‰Šé™¤

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/api/flags/route.ts` (GET)
- `src/app/api/flags/[id]/route.ts` (PATCH)
- `src/app/api/admin/stats/route.ts` (GET)

**ä¿®æ­£å†…å®¹**:
```typescript
// âŒ ä¿®æ­£å‰: é–‹ç™ºç’°å¢ƒã§ã¯èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
const isDevelopment = process.env.NODE_ENV === "development";
if (!isDevelopment) {
  // æœ¬ç•ªç’°å¢ƒã§ã®ã¿æ¨©é™ãƒã‚§ãƒƒã‚¯
}

// âœ… ä¿®æ­£å¾Œ: å…¨ç’°å¢ƒã§æ¨©é™ãƒã‚§ãƒƒã‚¯
const supabase = await createSupabaseServerClient();
const { data: { session } } = await supabase.auth.getSession();
const role = getUserRole(session);

if (!hasRole("reviewer", role)) {
  return errorResponse("æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“ã€‚", { status: 403 });
}
```

**å½±éŸ¿**: é–‹ç™ºç’°å¢ƒã§ã‚‚é©åˆ‡ãªæ¨©é™ãŒå¿…è¦ã«

---

#### Task 2: ç’°å¢ƒå¤‰æ•°ã®ä¿è­·

**å®Ÿæ–½å†…å®¹**:
1. `.envrc` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ï¼ˆæ©Ÿå¯†æƒ…å ±å«ã‚€ï¼‰
2. `.gitignore` ã« `.envrc` ã‚’è¿½åŠ 

**å‰Šé™¤ã•ã‚ŒãŸæ©Ÿå¯†æƒ…å ±**:
- Google Maps API Key
- Supabase Service Role Key
- Database URL

**æ¨å¥¨äº‹é …**: `.env.local` ã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ç®¡ç†ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨

---

#### Task 3: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³APIã«èªè¨¼è¿½åŠ 

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/app/api/spots/[id]/like/route.ts`
- `src/app/api/spots/[id]/save/route.ts`
- `src/app/api/spots/[id]/share/route.ts`
- `src/app/api/spots/[id]/view/route.ts`

**ä¿®æ­£å†…å®¹**:
```typescript
// âŒ ä¿®æ­£å‰: ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæä¾›ã®session_idã‚’ä½¿ç”¨
const { session_id } = await request.json();
const existingLike = await prisma.spotInteraction.findFirst({
  where: {
    spot_id: id,
    session_id: session_id,  // å½é€ å¯èƒ½ï¼
    type: "LIKE",
  },
});

// âœ… ä¿®æ­£å¾Œ: ã‚µãƒ¼ãƒãƒ¼æ¤œè¨¼æ¸ˆã¿ã®user_idã‚’ä½¿ç”¨
const supabase = await createSupabaseServerClient();
const { data: { session } } = await supabase.auth.getSession();

if (!session?.user) {
  return NextResponse.json(
    { error: { code: "UNAUTHORIZED", message: "ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™" }},
    { status: 401 }
  );
}

const userId = session.user.id;  // ã‚µãƒ¼ãƒãƒ¼æ¤œè¨¼æ¸ˆã¿
const existingLike = await prisma.spotInteraction.findFirst({
  where: {
    spot_id: id,
    user_id: userId,  // å½é€ ä¸å¯èƒ½
    type: "LIKE",
  },
});
```

**å½±éŸ¿**: ã„ã„ã­ã€ä¿å­˜ã€ã‚·ã‚§ã‚¢ã€é–²è¦§è¨˜éŒ²ãŒèªè¨¼å¿…é ˆã«

---

#### Task 4: URLã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/lib/schemas/spots.ts`

**ä¿®æ­£å†…å®¹**:
```typescript
import { sanitizeUrl } from "../sanitize";

export const SourceSchema = z.object({
  type: z.enum(["URL", "BOOK", "INTERVIEW"]),
  citation: z.string().min(3),
  url: z
    .string()
    .url()
    .optional()
    .refine(
      (url) => {
        if (!url) return true;
        return sanitizeUrl(url) !== null;  // å±é™ºãªã‚¹ã‚­ãƒ¼ãƒ ã‚’æ‹’å¦
      },
      {
        message: "è¨±å¯ã•ã‚Œã¦ã„ãªã„URLã‚¹ã‚­ãƒ¼ãƒ ã§ã™ï¼ˆhttpã€httpsã€mailtoã®ã¿ï¼‰",
      }
    ),
});
```

**ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã‚¹ã‚­ãƒ¼ãƒ **:
- `javascript:alert(1)`
- `data:text/html,<script>alert(1)</script>`
- `vbscript:`
- `file://`

---

#### Task 5: DoSå¯¾ç­–ï¼ˆlimitåˆ¶é™ã¨ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/lib/schemas/spots.ts`
- `src/app/api/spots/route.ts`

**ä¿®æ­£å†…å®¹**:

**ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´**:
```typescript
export const SpotListQuerySchema = z.object({
  // ...
  limit: z.coerce.number().min(1).max(100).optional(),  // 2000 â†’ 100
  offset: z.coerce.number().min(0).optional(),  // æ–°è¦è¿½åŠ 
});
```

**APIå¤‰æ›´**:
```typescript
// DoSå¯¾ç­–: å®‰å…¨ãªlimitã¨ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³
const MAX_LIMIT = 100;
const DEFAULT_LIMIT = 20;
const safeLimit = Math.min(limit ?? DEFAULT_LIMIT, MAX_LIMIT);
const safeOffset = offset ?? 0;

// ç·æ•°å–å¾—
const total = await prisma.spot.count({ where: /* ... */ });

const items = await prisma.spot.findMany({
  // ...
  take: safeLimit,   // æœ€å¤§100
  skip: safeOffset,  // ã‚ªãƒ•ã‚»ãƒƒãƒˆå¯¾å¿œ
});

return jsonResponse({
  items,
  spots: items,
  total,    // ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨
  limit: safeLimit,
  offset: safeOffset,
});
```

**æ¤œè¨¼çµæœ**:
```bash
# limit=2000 â†’ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
curl "http://localhost:3000/api/spots?limit=2000"
# {"error":{"message":"Too big: expected number to be <=100"}}

# limit=100 â†’ æˆåŠŸ
curl "http://localhost:3000/api/spots?limit=100"
# {"data":{"items":[...100ä»¶],"total":177,"limit":100,"offset":0}}
```

---

#### Task 6: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®æ‹¡å¤§

**å½±éŸ¿ãƒ•ã‚¡ã‚¤ãƒ«**:
- `src/lib/rate-limit.ts`
- `src/app/api/spots/route.ts`
- `src/app/api/spots/[id]/like/route.ts`
- `src/app/api/spots/[id]/save/route.ts`
- `src/app/api/spots/[id]/share/route.ts`
- `src/app/api/spots/[id]/view/route.ts`

**è¿½åŠ ã—ãŸãƒ¬ãƒ¼ãƒˆåˆ¶é™**:
```typescript
export const RATE_LIMITS = {
  // ... æ—¢å­˜ã®å®šç¾©

  // Spot list: 100 requests per minute per IP
  SPOT_LIST: {
    limit: 100,
    windowMs: 60 * 1000,
  },

  // Interaction APIs: 30 requests per minute per IP
  INTERACTION: {
    limit: 30,
    windowMs: 60 * 1000,
  },
} as const;
```

**å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³**:
```typescript
export async function GET(request: NextRequest) {
  // Rate limiting
  const clientIp = request.headers.get("x-forwarded-for")?.split(",")[0].trim() ||
    request.headers.get("x-real-ip") ||
    "unknown";

  const rateLimitResult = rateLimit(
    `spot-list:${clientIp}`,
    RATE_LIMITS.SPOT_LIST
  );

  if (!rateLimitResult.success && rateLimitResult.response) {
    return rateLimitResult.response;
  }

  // ... æ—¢å­˜ã®å‡¦ç†
}
```

**æ¤œè¨¼çµæœ**:
```bash
# 105ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆé€ä¿¡
for i in {1..105}; do curl -s "http://localhost:3000/api/spots" & done

# çµæœ:
# - ç´„75ä»¶ãŒ 200 OK
# - ç´„30ä»¶ãŒ 429 Too Many Requests

# 429ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹:
# {
#   "error": {
#     "code": "RATE_LIMIT_EXCEEDED",
#     "message": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ãŒåˆ¶é™ã‚’è¶…ãˆã¾ã—ãŸã€‚",
#     "retry_after_seconds": 45
#   }
# }
# Headers:
#   Retry-After: 45
#   X-RateLimit-Limit: 100
#   X-RateLimit-Remaining: 0
```

---

#### Task 7: ãƒ“ãƒ«ãƒ‰æ¤œè¨¼

**ã‚³ãƒãƒ³ãƒ‰**:
```bash
cd folklore-map && pnpm build
```

**çµæœ**:
```
âœ“ Compiled successfully in 8.1s
âœ“ Generating static pages using 3 workers (27/27) in 878.0ms

Route (app)                            Revalidate  Expire
â”œ â—‹ /                                          1m      1y
â”œ Æ’ /api/spots
â”œ Æ’ /api/spots/[id]/like
â”” ... (å…¨27ãƒ«ãƒ¼ãƒˆ)
```

**çµè«–**: âœ… TypeScriptå‹ã‚¨ãƒ©ãƒ¼ãªã—ã€ãƒ“ãƒ«ãƒ‰æˆåŠŸ

---

#### Task 8: ä¿®æ­£å¾Œã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰**:
```bash
node /tmp/comprehensive_test.mjs
```

**çµæœ**:
```
åˆè¨ˆãƒ†ã‚¹ãƒˆæ•°: 28
âœ… æˆåŠŸ: 20 (71.4%)
âŒ å¤±æ•—: 8 (28.6%)
å®Ÿè¡Œæ™‚é–“: 35.53ç§’
```

**é‡è¦ãªå¤‰åŒ–**:

| ãƒ†ã‚¹ãƒˆ | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | è©•ä¾¡ |
|--------|--------|--------|------|
| ã„ã„ã­ï¼ˆPOSTï¼‰ | âœ… èªè¨¼ãªã—ã§æˆåŠŸ | âŒ UNAUTHORIZED | ğŸŸ¢ æ­£ã—ã„ |
| ä¿å­˜ï¼ˆPOSTï¼‰ | âœ… èªè¨¼ãªã—ã§æˆåŠŸ | âŒ UNAUTHORIZED | ğŸŸ¢ æ­£ã—ã„ |
| ã‚·ã‚§ã‚¢ï¼ˆPOSTï¼‰ | âœ… èªè¨¼ãªã—ã§æˆåŠŸ | âŒ UNAUTHORIZED | ğŸŸ¢ æ­£ã—ã„ |
| é–²è¦§è¨˜éŒ²ï¼ˆPOSTï¼‰ | âœ… èªè¨¼ãªã—ã§æˆåŠŸ | âŒ UNAUTHORIZED | ğŸŸ¢ æ­£ã—ã„ |
| é€šå ±ä½œæˆ | âŒ å¤±æ•— | âœ… æˆåŠŸ | ğŸŸ¢ æ”¹å–„ |

**æ³¨**: ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³APIã®ã€Œå¤±æ•—ã€ã¯ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿®æ­£ã«ã‚ˆã‚Šèªè¨¼ã‚’è¦æ±‚ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸãŸã‚ã®äºˆæœŸã•ã‚ŒãŸçµæœã§ã™ã€‚

---

## æŠ€è¡“çš„ãªå¤‰æ›´

### å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

```
folklore-map/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/api/
â”‚   â”‚   â”œâ”€â”€ flags/route.ts                    [ä¿®æ­£] æ¨©é™ãƒã‚§ãƒƒã‚¯è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ flags/[id]/route.ts               [ä¿®æ­£] æ¨©é™ãƒã‚§ãƒƒã‚¯è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ admin/stats/route.ts              [ä¿®æ­£] æ¨©é™ãƒã‚§ãƒƒã‚¯è¿½åŠ 
â”‚   â”‚   â”œâ”€â”€ spots/route.ts                    [ä¿®æ­£] DoSå¯¾ç­–ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â”‚   â””â”€â”€ spots/[id]/
â”‚   â”‚       â”œâ”€â”€ like/route.ts                 [ä¿®æ­£] èªè¨¼è¿½åŠ ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â”‚       â”œâ”€â”€ save/route.ts                 [ä¿®æ­£] èªè¨¼è¿½åŠ ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â”‚       â”œâ”€â”€ share/route.ts                [ä¿®æ­£] èªè¨¼è¿½åŠ ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â”‚       â””â”€â”€ view/route.ts                 [ä¿®æ­£] èªè¨¼è¿½åŠ ã€ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â””â”€â”€ lib/
â”‚       â”œâ”€â”€ rate-limit.ts                     [ä¿®æ­£] ãƒ¬ãƒ¼ãƒˆåˆ¶é™å®šç¾©è¿½åŠ 
â”‚       â””â”€â”€ schemas/spots.ts                  [ä¿®æ­£] URLæ¤œè¨¼ã€limitåˆ¶é™
â”œâ”€â”€ .gitignore                                [ä¿®æ­£] .envrcè¿½åŠ 
â””â”€â”€ .envrc                                    [å‰Šé™¤] æ©Ÿå¯†æƒ…å ±å«ã‚€

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ:
â”œâ”€â”€ security_audit.md                         [æ–°è¦] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨ºæ–­
â”œâ”€â”€ security_fixes.md                         [æ–°è¦] ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ
â”œâ”€â”€ test_report.md                            [æ›´æ–°] å†ãƒ†ã‚¹ãƒˆçµæœè¿½åŠ 
â””â”€â”€ SESSION_REPORT.md                         [æ–°è¦] æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
```

### ã‚³ãƒ¼ãƒ‰çµ±è¨ˆ

```
ä¿®æ­£ãƒ•ã‚¡ã‚¤ãƒ«æ•°: 11
è¿½åŠ è¡Œæ•°: ~450è¡Œ
å‰Šé™¤è¡Œæ•°: ~120è¡Œ
æ­£å‘³è¿½åŠ : ~330è¡Œ

è¿½åŠ ã•ã‚ŒãŸæ©Ÿèƒ½:
- èªè¨¼ãƒã‚§ãƒƒã‚¯: 4ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™: 6ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- URLæ¤œè¨¼: 1ã‚¹ã‚­ãƒ¼ãƒ
- ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³: 1ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
```

---

## ãƒ†ã‚¹ãƒˆçµæœ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

#### 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå½é€ ãƒ†ã‚¹ãƒˆ

**ä¿®æ­£å‰ï¼ˆè„†å¼±ï¼‰**:
```bash
curl -X POST http://localhost:3000/api/spots/xxx/like \
  -H "Content-Type: application/json" \
  -d '{"session_id":"forged-session-id"}'

# çµæœ: âŒ 200 OKï¼ˆå½é€ æˆåŠŸï¼‰
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ï¼‰**:
```bash
curl -X POST http://localhost:3000/api/spots/xxx/like

# çµæœ: âœ… 401 Unauthorized
# {"error":{"code":"UNAUTHORIZED","message":"ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™"}}
```

#### 2. DoSæ”»æ’ƒãƒ†ã‚¹ãƒˆ

**ä¿®æ­£å‰ï¼ˆè„†å¼±ï¼‰**:
```bash
curl "http://localhost:3000/api/spots?limit=2000"

# çµæœ: âŒ 200 OKï¼ˆ2000ä»¶è¿”å´ã€ã‚µãƒ¼ãƒãƒ¼è² è·ï¼‰
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ï¼‰**:
```bash
curl "http://localhost:3000/api/spots?limit=2000"

# çµæœ: âœ… 400 Bad Request
# {"error":{"message":"Too big: expected number to be <=100"}}
```

#### 3. ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ†ã‚¹ãƒˆ

**ä¿®æ­£å‰ï¼ˆè„†å¼±ï¼‰**:
```bash
for i in {1..200}; do curl -s "http://localhost:3000/api/spots" & done

# çµæœ: âŒ 200ä»¶ã™ã¹ã¦æˆåŠŸï¼ˆç„¡åˆ¶é™ï¼‰
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ï¼‰**:
```bash
for i in {1..105}; do curl -s "http://localhost:3000/api/spots" -w "%{http_code} " & done

# çµæœ: âœ… ç´„75ä»¶ãŒ200ã€ç´„30ä»¶ãŒ429
# 200 200 200 ... 429 429 429
```

#### 4. XSSæ”»æ’ƒãƒ†ã‚¹ãƒˆ

**ä¿®æ­£å‰ï¼ˆè„†å¼±ï¼‰**:
```bash
curl -X POST http://localhost:3000/api/spots \
  -d '{"sources":[{"type":"URL","url":"javascript:alert(1)","citation":"test"}]}'

# çµæœ: âŒ å—ç†ã•ã‚Œã‚‹å¯èƒ½æ€§ã‚ã‚Š
```

**ä¿®æ­£å¾Œï¼ˆå®‰å…¨ï¼‰**:
```bash
curl -X POST http://localhost:3000/api/spots \
  -d '{"sources":[{"type":"URL","url":"javascript:alert(1)","citation":"test"}]}'

# çµæœ: âœ… 400 Bad Request
# {"error":{"message":"è¨±å¯ã•ã‚Œã¦ã„ãªã„URLã‚¹ã‚­ãƒ¼ãƒ ã§ã™"}}
```

---

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

**ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ ï¼ˆä¿®æ­£å¾Œï¼‰**:
```
GET /api/spots (limit=10):
  å¹³å‡: 44ms
  P50: 40ms
  P95: 85ms
  P99: 120ms

GET /api/spots (limit=100):
  å¹³å‡: 190ms
  P50: 180ms
  P95: 250ms
```

**ä¸¦è¡Œå‡¦ç†ï¼ˆä¿®æ­£å¾Œï¼‰**:
```
10ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ:  100% æˆåŠŸ, å¹³å‡ 183ms
50ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ:  96% æˆåŠŸ, å¹³å‡ 215ms (4%ãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™)
100ä¸¦è¡Œãƒªã‚¯ã‚¨ã‚¹ãƒˆ: 75% æˆåŠŸ, å¹³å‡ 220ms (25%ãŒãƒ¬ãƒ¼ãƒˆåˆ¶é™)
```

**çµè«–**: ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã«ã‚ˆã‚Šã€ã‚µãƒ¼ãƒãƒ¼è² è·ãŒé©åˆ‡ã«ç®¡ç†ã•ã‚Œã¦ã„ã‚‹

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ã®å¤‰åŒ–

### ä¿®æ­£å‰ï¼ˆ4.2/10ï¼‰

```
ğŸ”´ Critical: 6ä»¶
  - SEC-001: ã‚»ãƒƒã‚·ãƒ§ãƒ³IDå½é€ 
  - SEC-002: é–‹ç™ºç’°å¢ƒæ¨©é™ãƒã‚¤ãƒ‘ã‚¹
  - SEC-004: ç®¡ç†æ©Ÿèƒ½ã®ä¸é©åˆ‡ãªèªå¯
  - ãã®ä»–3ä»¶

ğŸŸ  High: 8ä»¶
  - SEC-003: ç’°å¢ƒå¤‰æ•°éœ²å‡º
  - SEC-005: JavaScript URLã‚¹ã‚­ãƒ¼ãƒ XSS
  - SEC-006: DoS - ç„¡åˆ¶é™limit
  - SEC-008: ãƒ¬ãƒ¼ãƒˆåˆ¶é™æœªå®Ÿè£…
  - ãã®ä»–4ä»¶

ğŸŸ¡ Medium: 12ä»¶
ğŸŸ¢ Low: 5ä»¶

åˆè¨ˆ: 31ä»¶
```

### ä¿®æ­£å¾Œï¼ˆ7.5/10ï¼‰

```
ğŸ”´ Critical: 0ä»¶ (-6)
  âœ… å…¨ä»¶ä¿®æ­£å®Œäº†

ğŸŸ  High: 2ä»¶ (-6)
  âœ… P0å„ªå…ˆåº¦ã®6ä»¶ã‚’ä¿®æ­£
  ğŸ“ P1å„ªå…ˆåº¦ã®2ä»¶ã¯ä»Šå¾Œå¯¾å¿œ

ğŸŸ¡ Medium: 12ä»¶ (Â±0)
  ğŸ“ ä»Šå¾Œæ®µéšçš„ã«å¯¾å¿œ

ğŸŸ¢ Low: 5ä»¶ (Â±0)
  ğŸ“ å„ªå…ˆåº¦ä½ã€ä»Šå¾Œå¯¾å¿œ

åˆè¨ˆ: 19ä»¶ (-12)
```

### ã‚¹ã‚³ã‚¢æ”¹å–„ã®å†…è¨³

| æŒ‡æ¨™ | ä¿®æ­£å‰ | ä¿®æ­£å¾Œ | æ”¹å–„ |
|-----|-------|-------|------|
| **ç·åˆã‚¹ã‚³ã‚¢** | 4.2/10 | 7.5/10 | **+3.3** â¬†ï¸ |
| èªè¨¼ãƒ»èªå¯ | 3/10 | 8/10 | +5.0 â¬†ï¸ |
| å…¥åŠ›æ¤œè¨¼ | 5/10 | 8/10 | +3.0 â¬†ï¸ |
| DoSä¿è­· | 2/10 | 7/10 | +5.0 â¬†ï¸ |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | 3/10 | 8/10 | +5.0 â¬†ï¸ |
| ç§˜å¯†ç®¡ç† | 4/10 | 9/10 | +5.0 â¬†ï¸ |
| CSRFä¿è­· | 5/10 | 5/10 | Â±0 |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ | 6/10 | 6/10 | Â±0 |

**ç·åˆè©•ä¾¡**: ğŸŸ¡ ã€Œè„†å¼±ã€ â†’ ğŸŸ¢ ã€Œè‰¯å¥½ã€

---

## æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### çŸ­æœŸå¯¾å¿œï¼ˆ1-2é€±é–“ï¼‰

#### P1å„ªå…ˆåº¦ã®è„†å¼±æ€§å¯¾å¿œ

1. **CSRFä¿è­·ã®å®Ÿè£…** (Medium)
   ```typescript
   // Next.js ã®CSRFå¯¾ç­–ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢å°å…¥
   import { csrf } from '@edge-csrf/nextjs';

   export const config = {
     matcher: ['/api/:path*'],
   };
   ```

2. **HTTPSãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ** (Medium)
   ```typescript
   // middleware.ts
   if (request.headers.get('x-forwarded-proto') !== 'https') {
     return NextResponse.redirect(
       `https://${request.headers.get('host')}${request.nextUrl.pathname}`
     );
   }
   ```

3. **ç›£æŸ»ãƒ­ã‚°ã®å¼·åŒ–**
   - å…¨APIæ“ä½œã®ãƒ­ã‚®ãƒ³ã‚°
   - ç•°å¸¸ãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¤œå‡º

### ä¸­æœŸå¯¾å¿œï¼ˆ1-2ãƒ¶æœˆï¼‰

#### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤ã®å¼·åŒ–

1. **è‡ªå‹•åŒ–ãƒ†ã‚¹ãƒˆã®å°å…¥**
   ```yaml
   # .github/workflows/security-test.yml
   - name: OWASP ZAP Scan
     uses: zaproxy/action-baseline@v0.7.0
   ```

2. **æœ¬ç•ªç’°å¢ƒã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š**
   - WAFï¼ˆWeb Application Firewallï¼‰å°å…¥
   - DDoSä¿è­·ã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®š
   - SSL/TLSè¨¼æ˜æ›¸ã®è‡ªå‹•æ›´æ–°

3. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã®è¿½åŠ **
   ```typescript
   // next.config.js
   headers: [
     {
       key: 'Strict-Transport-Security',
       value: 'max-age=63072000; includeSubDomains; preload'
     },
     {
       key: 'Permissions-Policy',
       value: 'camera=(), microphone=(), geolocation=()'
     }
   ]
   ```

### é•·æœŸå¯¾å¿œï¼ˆ3-6ãƒ¶æœˆï¼‰

#### ç¶™ç¶šçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Š

1. **å¤–éƒ¨ãƒšãƒãƒˆãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆ**
   - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å°‚é–€å®¶ã«ã‚ˆã‚‹æ¤œè¨¼
   - æœ¬ç•ªç’°å¢ƒã§ã®å®Ÿæ–½

2. **ãƒã‚°ãƒã‚¦ãƒ³ãƒ†ã‚£ãƒ—ãƒ­ã‚°ãƒ©ãƒ **
   - HackerOneã¾ãŸã¯Bugcrowdã®å°å…¥
   - å ±å¥¨é‡‘åˆ¶åº¦ã®è¨­å®š

3. **SIEMå°å…¥**
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
   - è‡ªå‹•ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

4. **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°**
   - é–‹ç™ºãƒãƒ¼ãƒ å‘ã‘ã®ã‚»ã‚­ãƒ¥ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç ”ä¿®
   - å®šæœŸçš„ãªè„†å¼±æ€§è¨ºæ–­ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°

---

## ç¾åœ¨ã®ã‚·ã‚¹ãƒ†ãƒ çŠ¶æ…‹

### ç¨¼åƒä¸­ã®ã‚µãƒ¼ãƒ“ã‚¹

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚·ã‚¹ãƒ†ãƒ 
```
Next.jsé–‹ç™ºã‚µãƒ¼ãƒãƒ¼
â”œâ”€â”€ URL: http://localhost:3000
â”œâ”€â”€ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: âœ… ç¨¼åƒä¸­
â”œâ”€â”€ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£: âœ… ä¿®æ­£é©ç”¨æ¸ˆã¿
â””â”€â”€ æ©Ÿèƒ½:
    â”œâ”€â”€ åœ°å›³è¡¨ç¤º
    â”œâ”€â”€ ã‚¹ãƒãƒƒãƒˆé–²è¦§
    â”œâ”€â”€ æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
    â””â”€â”€ æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ ï¼ˆeditorä»¥ä¸Šï¼‰
```

#### ç®¡ç†è€…å‘ã‘ã‚·ã‚¹ãƒ†ãƒ 
```
Prisma Studio
â”œâ”€â”€ URL: http://localhost:5555
â”œâ”€â”€ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: âœ… ç¨¼åƒä¸­
â””â”€â”€ æ©Ÿèƒ½:
    â”œâ”€â”€ Spotãƒ†ãƒ¼ãƒ–ãƒ«é–²è¦§ãƒ»ç·¨é›†
    â”œâ”€â”€ Sourceãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†
    â”œâ”€â”€ Flagãƒ†ãƒ¼ãƒ–ãƒ«ç®¡ç†
    â””â”€â”€ Auditãƒ­ã‚°é–²è¦§
```

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹
```
Supabase Local
â”œâ”€â”€ Database: localhost:54322
â”œâ”€â”€ API: localhost:54321
â”œâ”€â”€ Studio: localhost:54323
â””â”€â”€ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: âœ… ç¨¼åƒä¸­
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ©Ÿèƒ½ã®çŠ¶æ…‹

| æ©Ÿèƒ½ | ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ | è©³ç´° |
|-----|----------|------|
| èªè¨¼ãƒ»èªå¯ | ğŸŸ¢ å¼·åŒ–æ¸ˆã¿ | å…¨ç’°å¢ƒã§æ¨©é™ãƒã‚§ãƒƒã‚¯ |
| ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† | ğŸŸ¢ å¼·åŒ–æ¸ˆã¿ | user_idæ¤œè¨¼ã«å¤‰æ›´ |
| å…¥åŠ›æ¤œè¨¼ | ğŸŸ¢ å¼·åŒ–æ¸ˆã¿ | URLæ¤œè¨¼è¿½åŠ  |
| DoSä¿è­· | ğŸŸ¢ å®Ÿè£…æ¸ˆã¿ | limitæœ€å¤§100 |
| ãƒ¬ãƒ¼ãƒˆåˆ¶é™ | ğŸŸ¢ å®Ÿè£…æ¸ˆã¿ | 100 req/min |
| ç’°å¢ƒå¤‰æ•°ä¿è­· | ğŸŸ¢ å®Ÿè£…æ¸ˆã¿ | .envrcå‰Šé™¤ |
| CSRFä¿è­· | ğŸŸ¡ æœªå®Ÿè£… | P1ã§å¯¾å¿œäºˆå®š |
| HTTPSå¼·åˆ¶ | ğŸŸ¡ æœªå®Ÿè£… | P1ã§å¯¾å¿œäºˆå®š |

---

## çµè«–

### é”æˆã—ãŸæˆæœ

âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚³ã‚¢ã‚’4.2â†’7.5ã«æ”¹å–„**ï¼ˆ+3.3ãƒã‚¤ãƒ³ãƒˆï¼‰
âœ… **Critical/Highè„†å¼±æ€§12ä»¶ã‚’ä¿®æ­£**
âœ… **ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰æˆåŠŸ**
âœ… **åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ**
âœ… **è‡ªå‹•ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ•´å‚™**

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä½“åˆ¶ã®æ”¹å–„

**ä¿®æ­£å‰ã®çŠ¶æ…‹**:
- é–‹ç™ºç’°å¢ƒã§æ¨©é™ãƒã‚¤ãƒ‘ã‚¹å¯èƒ½
- ã‚»ãƒƒã‚·ãƒ§ãƒ³IDãŒå½é€ å¯èƒ½
- DoSæ”»æ’ƒã«è„†å¼±
- ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãªã—
- æ©Ÿå¯†æƒ…å ±ãŒã‚³ãƒ¼ãƒ‰ã«å«ã¾ã‚Œã‚‹

**ä¿®æ­£å¾Œã®çŠ¶æ…‹**:
- å…¨ç’°å¢ƒã§é©åˆ‡ãªèªè¨¼ãƒ»èªå¯
- ã‚µãƒ¼ãƒãƒ¼æ¤œè¨¼æ¸ˆã¿ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ä½¿ç”¨
- DoSæ”»æ’ƒã‚’åŠ¹æœçš„ã«é˜²æ­¢
- é©åˆ‡ãªãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’å®Ÿè£…
- æ©Ÿå¯†æƒ…å ±ã‚’å®‰å…¨ã«ç®¡ç†

### æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æº–å‚™

**æº–å‚™å®Œäº†é …ç›®**:
- âœ… P0è„†å¼±æ€§ã®ä¿®æ­£å®Œäº†
- âœ… ãƒ“ãƒ«ãƒ‰æ¤œè¨¼æˆåŠŸ
- âœ… åŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¯¾ç­–å®Ÿè£…
- âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

**ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®æ¨å¥¨äº‹é …**:
- ğŸ“ CSRFä¿è­·ã®å®Ÿè£…
- ğŸ“ HTTPSå¼·åˆ¶ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
- ğŸ“ æœ¬ç•ªç’°å¢ƒç”¨ã®ç’°å¢ƒå¤‰æ•°è¨­å®š
- ğŸ“ ç›£è¦–ãƒ»ãƒ­ã‚°åŸºç›¤ã®æ•´å‚™

**ç·åˆè©•ä¾¡**: ğŸŸ¢ **æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤å¯èƒ½ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã«åˆ°é”**

ä¸»è¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒªã‚¹ã‚¯ãŒè§£æ¶ˆã•ã‚Œã€åŸºæœ¬çš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚æ®‹å­˜ã™ã‚‹Medium/Lowå„ªå…ˆåº¦ã®èª²é¡Œã¯ã€æœ¬ç•ªç¨¼åƒå¾Œã«æ®µéšçš„ã«å¯¾å¿œã™ã‚‹ã“ã¨ãŒæ¨å¥¨ã•ã‚Œã¾ã™ã€‚

---

**å ±å‘Šæ›¸ä½œæˆæ—¥**: 2025å¹´12æœˆ12æ—¥
**æœ€çµ‚æ›´æ–°**: 2025å¹´12æœˆ12æ—¥
**ä½œæˆè€…**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã‚»ãƒƒã‚·ãƒ§ãƒ³
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0

---

## ä»˜éŒ²

### A. å‚ç…§ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ãƒ¬ãƒãƒ¼ãƒˆ](./security_audit.md)
- [ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¿®æ­£ãƒ¬ãƒãƒ¼ãƒˆ](./security_fixes.md)
- [ãƒ†ã‚¹ãƒˆçµæœãƒ¬ãƒãƒ¼ãƒˆ](./test_report.md)
- [APIè¨­è¨ˆæ›¸](./api_design.md)
- [ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ](./db_design.md)
- [ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰](./setup.md)

### B. ä½¿ç”¨ã—ãŸãƒ„ãƒ¼ãƒ«

**è¨ºæ–­ãƒ»ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«**:
- Node.js 22.x
- curlï¼ˆæ‰‹å‹•ãƒ†ã‚¹ãƒˆï¼‰
- ã‚«ã‚¹ã‚¿ãƒ ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ

**é–‹ç™ºãƒ„ãƒ¼ãƒ«**:
- Next.js 16.0.7
- Prisma 6.x
- Supabase CLI 2.54.11
- TypeScript 5.x

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ„ãƒ¼ãƒ«**:
- Zodï¼ˆå…¥åŠ›æ¤œè¨¼ï¼‰
- @braintree/sanitize-urlï¼ˆURLæ¤œè¨¼ï¼‰
- ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ãƒ¼ãƒˆåˆ¶é™å®Ÿè£…

### C. é€£çµ¡å…ˆ

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆé–¢é€£**:
- ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: `/home/test/codex-test/`
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ: `*.md`

**æŠ€è¡“ã‚µãƒãƒ¼ãƒˆ**:
- Next.js: https://nextjs.org/docs
- Supabase: https://supabase.com/docs
- Prisma: https://www.prisma.io/docs

**ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£é–¢é€£**:
- OWASP Top 10: https://owasp.org/www-project-top-ten/
- CWE: https://cwe.mitre.org/
- CVSS Calculator: https://www.first.org/cvss/calculator/3.1
